{
  "metadata": {
    "dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v5.json",
    "dbt_version": "1.7.0",
    "generated_at": "2024-03-11T21:01:31.042818Z",
    "invocation_id": "f5bcce83-3d15-497a-84a8-a49e739cc788",
    "env": {}
  },
  "results": [
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2024-03-11T21:01:30.200535Z",
          "completed_at": "2024-03-11T21:01:30.225470Z"
        },
        {
          "name": "execute",
          "started_at": "2024-03-11T21:01:30.277608Z",
          "completed_at": "2024-03-11T21:01:30.381375Z"
        }
      ],
      "thread_id": "Thread-2 (worker)",
      "execution_time": 0.19762659072875977,
      "adapter_response": {
        "_message": "OK"
      },
      "message": "OK",
      "failures": null,
      "unique_id": "model.coffee_shop_dbt.stg_locations",
      "compiled": true,
      "compiled_code": "\n\nwith\n\nsource as (\n\n    select * from read_csv_auto(\"coffee-data/raw/raw_stores.csv\", header=1)\n\n    --- data runs to 2026, truncate timespan to desired range, current time as default\n    where opened_at <= now()\n\n),\n\nrenamed as (\n\n    select\n\n        ----------  ids\n        id as location_id,\n\n        ---------- properties\n        name as location_name,\n        tax_rate,\n\n        ---------- timestamp\n        opened_at\n\n    from source\n\n)\n\nselect * from renamed",
      "relation_name": "\"coffee_shop\".\"main\".\"stg_locations\""
    },
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2024-03-11T21:01:30.192964Z",
          "completed_at": "2024-03-11T21:01:30.215225Z"
        },
        {
          "name": "execute",
          "started_at": "2024-03-11T21:01:30.226892Z",
          "completed_at": "2024-03-11T21:01:30.398987Z"
        }
      ],
      "thread_id": "Thread-1 (worker)",
      "execution_time": 0.2178361415863037,
      "adapter_response": {
        "_message": "OK"
      },
      "message": "OK",
      "failures": null,
      "unique_id": "model.coffee_shop_dbt.stg_customers",
      "compiled": true,
      "compiled_code": "\n\nwith\n\nsource as (\n\n    select * from read_csv_auto(\"coffee-data/raw/raw_customers.csv\", header=1)\n\n),\n\nrenamed as (\n\n    select\n\n        ----------  ids\n        id as customer_id,\n\n        ---------- properties\n        name as customer_name\n\n    from source\n\n)\n\nselect * from renamed",
      "relation_name": "\"coffee_shop\".\"main\".\"stg_customers\""
    },
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2024-03-11T21:01:30.385525Z",
          "completed_at": "2024-03-11T21:01:30.390952Z"
        },
        {
          "name": "execute",
          "started_at": "2024-03-11T21:01:30.391733Z",
          "completed_at": "2024-03-11T21:01:30.469693Z"
        }
      ],
      "thread_id": "Thread-2 (worker)",
      "execution_time": 0.0904085636138916,
      "adapter_response": {
        "_message": "OK"
      },
      "message": "OK",
      "failures": null,
      "unique_id": "model.coffee_shop_dbt.stg_products",
      "compiled": true,
      "compiled_code": "\n\nwith\n\nsource as (\n\n    select * from read_csv_auto(\"coffee-data/raw/raw_products.csv\", header=1)\n\n),\n\nrenamed as (\n\n    select\n\n        ----------  ids\n        sku as product_id,\n\n        ---------- properties\n        name as product_name,\n        type as product_type,\n        description as product_description,\n        (price / 100.0)::float as product_price,\n\n\n        ---------- derived\n        case\n            when type = 'food' then 1\n            else 0\n        end is_food_item,\n\n        case\n            when type = 'beverage' then 1\n            else 0\n        end is_drink_item\n\n    from source\n\n)\n\nselect * from renamed",
      "relation_name": "\"coffee_shop\".\"main\".\"stg_products\""
    },
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2024-03-11T21:01:30.407935Z",
          "completed_at": "2024-03-11T21:01:30.411633Z"
        },
        {
          "name": "execute",
          "started_at": "2024-03-11T21:01:30.412492Z",
          "completed_at": "2024-03-11T21:01:30.480114Z"
        }
      ],
      "thread_id": "Thread-1 (worker)",
      "execution_time": 0.0743703842163086,
      "adapter_response": {
        "_message": "OK"
      },
      "message": "OK",
      "failures": null,
      "unique_id": "model.coffee_shop_dbt.stg_supplies",
      "compiled": true,
      "compiled_code": "\n\nwith\n\nsource as (\n\n    select * from read_csv_auto(\"coffee-data/raw/raw_supplies.csv\", header=1)\n\n),\n\nrenamed as (\n\n    select\n\n        ----------  ids\n        \n    \nmd5(cast(coalesce(cast(id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(sku as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as supply_uuid,\n        id as supply_id,\n        sku as product_id,\n\n        ---------- properties\n        name as supply_name,\n        (cost / 100.0)::float as supply_cost,\n        perishable as is_perishable_supply\n\n    from source\n\n)\n\nselect * from renamed",
      "relation_name": "\"coffee_shop\".\"main\".\"stg_supplies\""
    },
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2024-03-11T21:01:30.209832Z",
          "completed_at": "2024-03-11T21:01:30.232072Z"
        },
        {
          "name": "execute",
          "started_at": "2024-03-11T21:01:30.281069Z",
          "completed_at": "2024-03-11T21:01:30.608397Z"
        }
      ],
      "thread_id": "Thread-3 (worker)",
      "execution_time": 0.4219188690185547,
      "adapter_response": {
        "_message": "OK"
      },
      "message": "OK",
      "failures": null,
      "unique_id": "model.coffee_shop_dbt.stg_order_items",
      "compiled": true,
      "compiled_code": "\n\nwith\n\nsource as (\n\n    select * from read_csv_auto(\"coffee-data/raw/raw_items.csv\", header=1)\n\n),\n\nrenamed as (\n\n    select\n\n        ----------  ids\n        id as order_item_id,\n        order_id,\n\n        ---------- properties\n        sku as product_id\n\n    from source\n\n)\n\nselect * from renamed",
      "relation_name": "\"coffee_shop\".\"main\".\"stg_order_items\""
    },
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2024-03-11T21:01:30.217090Z",
          "completed_at": "2024-03-11T21:01:30.233170Z"
        },
        {
          "name": "execute",
          "started_at": "2024-03-11T21:01:30.284622Z",
          "completed_at": "2024-03-11T21:01:30.621624Z"
        }
      ],
      "thread_id": "Thread-4 (worker)",
      "execution_time": 0.4441709518432617,
      "adapter_response": {
        "_message": "OK"
      },
      "message": "OK",
      "failures": null,
      "unique_id": "model.coffee_shop_dbt.stg_orders",
      "compiled": true,
      "compiled_code": "\n\nwith\n\nsource as (\n\n    select * from read_csv_auto(\"coffee-data/raw/raw_orders.csv\", header=1)\n\n    -- data runs to 2026, truncate timespan to desired range,\n    -- current time as default\n    where ordered_at <= now()\n\n),\n\nrenamed as (\n\n    select\n\n        ----------  ids\n        id as order_id,\n        store_id as location_id,\n        customer as customer_id,\n\n        ---------- properties\n        (order_total / 100.0)::float as order_total,\n        (tax_paid / 100.0)::float as tax_paid,\n\n        ---------- timestamps\n        ordered_at\n\n    from source\n\n)\n\nselect * from renamed",
      "relation_name": "\"coffee_shop\".\"main\".\"stg_orders\""
    },
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2024-03-11T21:01:30.643329Z",
          "completed_at": "2024-03-11T21:01:30.651085Z"
        },
        {
          "name": "execute",
          "started_at": "2024-03-11T21:01:30.652891Z",
          "completed_at": "2024-03-11T21:01:30.900003Z"
        }
      ],
      "thread_id": "Thread-2 (worker)",
      "execution_time": 0.27004575729370117,
      "adapter_response": {
        "_message": "OK"
      },
      "message": "OK",
      "failures": null,
      "unique_id": "model.coffee_shop_dbt.orders",
      "compiled": true,
      "compiled_code": "\n\nwith\n\norders_set as (\n\n    select * from \"coffee_shop\".\"main\".\"stg_orders\"\n\n    where\n        true\n\n        \n\n),\n\norder_items as (\n\n    select * from \"coffee_shop\".\"main\".\"stg_order_items\"\n\n),\n\nproducts as (\n\n    select * from \"coffee_shop\".\"main\".\"stg_products\"\n\n),\n\nlocations as (\n\n    select * from \"coffee_shop\".\"main\".\"stg_locations\"\n\n),\n\nsupplies as (\n\n    select * from \"coffee_shop\".\"main\".\"stg_supplies\"\n\n),\n\norder_items_summary as (\n\n    select\n\n        order_items.order_id,\n\n        sum(products.is_food_item) as count_food_items,\n        sum(products.is_drink_item) as count_drink_items,\n        count(*) as count_items,\n        sum(\n            case\n                when products.is_food_item = 1 then products.product_price\n                else 0\n            end\n        ) as subtotal_drink_items,\n        sum(\n            case\n                when products.is_drink_item = 1 then products.product_price\n                else 0\n            end\n        ) as subtotal_food_items,\n        sum(products.product_price) as subtotal\n\n    from order_items\n\n    left join products on order_items.product_id = products.product_id\n\n    group by 1\n\n),\n\norder_supplies_summary as (\n\n    select\n\n        order_items.order_id,\n\n        sum(supplies.supply_cost) as order_cost\n\n    from order_items\n\n    left join supplies on order_items.product_id = supplies.product_id\n\n    group by 1\n\n),\n\njoined as (\n\n    select\n\n        orders_set.*,\n\n        order_items_summary.count_food_items,\n        order_items_summary.count_drink_items,\n        order_items_summary.count_items,\n\n        order_items_summary.subtotal_drink_items,\n        order_items_summary.subtotal_food_items,\n        order_items_summary.subtotal,\n\n        order_supplies_summary.order_cost,\n        locations.location_name\n\n    from orders_set\n\n    left join order_items_summary\n        on orders_set.order_id = order_items_summary.order_id\n    left join order_supplies_summary\n        on orders_set.order_id = order_supplies_summary.order_id\n    left join locations\n        on orders_set.location_id = locations.location_id\n\n),\n\nfinal as (\n\n    select\n\n        *,\n        count_food_items > 0 as is_food_order,\n        count_drink_items > 0 as is_drink_order\n\n    from joined\n\n)\n\nselect * from final",
      "relation_name": "\"coffee_shop\".\"main\".\"orders\""
    },
    {
      "status": "success",
      "timing": [
        {
          "name": "compile",
          "started_at": "2024-03-11T21:01:30.919268Z",
          "completed_at": "2024-03-11T21:01:30.924725Z"
        },
        {
          "name": "execute",
          "started_at": "2024-03-11T21:01:30.926152Z",
          "completed_at": "2024-03-11T21:01:30.995192Z"
        }
      ],
      "thread_id": "Thread-3 (worker)",
      "execution_time": 0.08746457099914551,
      "adapter_response": {
        "_message": "OK"
      },
      "message": "OK",
      "failures": null,
      "unique_id": "model.coffee_shop_dbt.customers",
      "compiled": true,
      "compiled_code": "\n\nwith\n\ncustomers as (\n\n    select * from \"coffee_shop\".\"main\".\"stg_customers\"\n\n),\n\norders_mart as (\n    select * from \"coffee_shop\".\"main\".\"orders\"\n\n),\n\norder_summary as (\n\n    select\n        customer_id,\n\n        count(*) as count_lifetime_orders,\n        count(*) > 1 as is_repeat_buyer,\n        min(ordered_at) as first_ordered_at,\n        max(ordered_at) as last_ordered_at,\n\n        sum(subtotal) as lifetime_spend_pretax,\n        sum(order_total) as lifetime_spend\n\n    from orders_mart\n    group by 1\n\n),\n\njoined as (\n\n    select\n        customers.*,\n        order_summary.count_lifetime_orders,\n        order_summary.first_ordered_at,\n        order_summary.last_ordered_at,\n        order_summary.lifetime_spend_pretax,\n        order_summary.lifetime_spend,\n\n        case\n            when order_summary.is_repeat_buyer then 'returning'\n            else 'new'\n        end as customer_type\n\n    from customers\n\n    left join order_summary\n        on customers.customer_id = order_summary.customer_id\n\n)\n\nselect * from joined",
      "relation_name": "\"coffee_shop\".\"main\".\"customers\""
    }
  ],
  "elapsed_time": 1.0648481845855713,
  "args": {
    "printer_width": 80,
    "warn_error_options": {
      "include": [],
      "exclude": []
    },
    "send_anonymous_usage_stats": true,
    "cache_selected_only": false,
    "log_level": "info",
    "defer": false,
    "log_path": "/home/nielsc/workspace/dataminded/conveyor-samples/basic/coffee_shop_dbt/logs",
    "use_colors_file": true,
    "log_format": "default",
    "indirect_selection": "eager",
    "macro_debugging": false,
    "print": true,
    "show_resource_report": false,
    "vars": {},
    "introspect": true,
    "which": "run",
    "strict_mode": false,
    "write_json": true,
    "log_level_file": "debug",
    "version_check": true,
    "use_colors": true,
    "log_file_max_bytes": 10485760,
    "profiles_dir": "/home/nielsc/workspace/dataminded/conveyor-samples/basic/coffee_shop_dbt",
    "select": [],
    "project_dir": "/home/nielsc/workspace/dataminded/conveyor-samples/basic/coffee_shop_dbt",
    "populate_cache": true,
    "invocation_command": "dbt run",
    "enable_legacy_logger": false,
    "partial_parse": true,
    "static_parser": true,
    "favor_state": false,
    "log_format_file": "debug",
    "quiet": false,
    "partial_parse_file_diff": true,
    "exclude": []
  }
}
